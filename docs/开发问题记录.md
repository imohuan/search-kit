# 开发问题记录

本文档记录开发过程中遇到的问题和解决方案，避免重复犯错。

---

## 问题 1: Tailwind CSS v4 中 Vue 组件使用 @apply 报错

### 日期
2026-01-14

### 问题描述
在 Vue 组件的 `<style scoped>` 中使用 Tailwind CSS 的 `@apply` 指令时，编译报错：
```
Cannot apply unknown utility class `w-4`. Are you using CSS modules or similar and missing `@reference`?
```

### 原因分析
Tailwind CSS v4 中，如果在 Vue/Svelte 组件的 `<style>` 模块中使用 `@apply` 或 `@variant`，需要先通过 `@reference` 指令导入主题变量、自定义工具和自定义变体。

### 解决方案
在每个使用 `@apply` 的 Vue 组件 `<style>` 标签开头添加 `@reference` 指令：

```vue
<style scoped>
@reference "@/style.css";

.my-class {
  @apply flex items-center;
}
</style>
```

### 教训总结

1. **检查要彻底**：第一次修复时只用 `grep` 搜索找到了 4 个文件，但实际上有 10 个文件需要修复。应该使用更可靠的方法进行全面检查。

2. **正确的检查方法**：使用 PowerShell 脚本同时检查包含 `@apply` 但不包含 `@reference` 的文件：
   ```powershell
   Get-ChildItem -Path src -Recurse -Filter "*.vue" | ForEach-Object { 
     $content = Get-Content $_.FullName -Raw
     if ($content -match "@apply" -and $content -notmatch "@reference") { 
       Write-Output $_.FullName 
     } 
   }
   ```

3. **修复后要验证**：每次修复后都要重新运行检查脚本，确保没有遗漏。

### 受影响的文件清单
- `src/components/modal/SettingsModal.vue`
- `src/components/modal/DetailModal.vue`
- `src/modules/library/pages/LibraryView.vue`
- `src/modules/library/components/FileCard.vue`
- `src/modules/library/components/FileList.vue`
- `src/modules/library/components/FileUploader.vue`
- `src/modules/search/pages/SearchView.vue`
- `src/modules/search/components/SearchBar.vue`
- `src/modules/search/components/SearchResults.vue`
- `src/modules/search/components/ResultCard.vue`
- `src/modules/search/components/SnippetDropdown.vue`
- `src/modules/search/components/DocFilterModal.vue`

### 参考链接
- [Tailwind CSS @reference 指令文档](https://tailwindcss.com/docs/functions-and-directives#reference-directive)

---

## 问题 2: @vicons/material 图标大小控制方式错误

### 日期
2026-01-14

### 问题描述
在使用 `@vicons/material` 图标组件时，错误地使用了 `text-*` 类（如 `text-xl`、`text-2xl`）来控制图标大小，这是控制字体大小的类，不应该用于图标。

### 原因分析
`@vicons/material` 图标组件本质上是 SVG 元素，应该通过设置宽高来控制大小，而不是字体大小。使用 `text-*` 类会导致：
1. 图标大小不精确
2. 语义不清晰
3. 可能导致布局问题

### 正确做法

**❌ 错误示例：**
```vue
<template>
  <CloudUploadOutlined class="text-xl text-indigo-600" />
</template>

<style scoped>
.upload-icon {
  @apply text-indigo-600 text-xl;
}
</style>
```

**✅ 正确示例：**
```vue
<template>
  <!-- 方式 1: 直接使用 Tailwind 的 w-* h-* 类 -->
  <CloudUploadOutlined class="w-6 h-6 text-indigo-600" />
  
  <!-- 方式 2: 使用 Tailwind 的 size-* 类（推荐，更简洁） -->
  <CloudUploadOutlined class="size-6 text-indigo-600" />
</template>

<style scoped>
@reference "@/style.css";

.upload-icon {
  @apply text-indigo-600 size-6;
}
</style>
```

### 图标大小参考

| 使用场景 | 推荐大小 | Tailwind 类 |
|---------|---------|------------|
| 小图标（按钮内） | 16px | `size-4` 或 `w-4 h-4` |
| 常规图标 | 20px | `size-5` 或 `w-5 h-5` |
| 中等图标 | 24px | `size-6` 或 `w-6 h-6` |
| 大图标 | 32px | `size-8` 或 `w-8 h-8` |
| 特大图标 | 48px | `size-12` 或 `w-12 h-12` |

### 检查方法

使用以下 PowerShell 脚本检查所有使用 `text-*` 控制图标大小的情况：

```powershell
# 检查模板中的错误用法
Get-ChildItem -Path src -Recurse -Filter "*.vue" | ForEach-Object { 
  $content = Get-Content $_.FullName -Raw
  if ($content -match "Outlined.*class=.*text-(xl|2xl|3xl|4xl|5xl|6xl|7xl|8xl|9xl)") { 
    Write-Output $_.FullName 
  } 
}

# 检查 style 标签中的错误用法
Get-ChildItem -Path src -Recurse -Filter "*.vue" | ForEach-Object { 
  $content = Get-Content $_.FullName -Raw
  if ($content -match "@apply.*text-(xl|2xl|3xl|4xl|5xl|6xl|7xl|8xl|9xl)") { 
    Write-Output $_.FullName 
  } 
}
```

### 受影响的文件
- `src/modules/library/components/FileUploader.vue` - 已修复
- `src/modules/search/components/DocFilterModal.vue` - 已修复（移除 Phosphor Icons 字体图标）

### 教训总结

1. **理解组件本质**：图标组件是 SVG，应该用宽高控制大小，而不是字体大小
2. **使用语义化的类**：`size-*` 或 `w-* h-*` 比 `text-*` 更语义化
3. **建立规范**：在项目初期就应该明确图标使用规范，避免后期大量修改
4. **代码审查**：在 Code Review 时注意检查这类问题
5. **统一图标库**：项目应该只使用一种图标库（本项目使用 `@vicons/material`），避免混用字体图标（如 Phosphor Icons 的 `<i class="ph-*">`）和 Vue 组件图标

### 参考链接
- [Tailwind CSS Size 文档](https://tailwindcss.com/docs/size)
- [Tailwind CSS Width/Height 文档](https://tailwindcss.com/docs/width)

---

## 问题 3: 混用不同图标库导致的一致性问题

### 日期
2026-01-14

### 问题描述
在项目中发现混用了两种图标库：
1. **@vicons/material** - Vue 组件形式的图标（正确）
2. **Phosphor Icons** - 使用 `<i class="ph ph-*">` 的字体图标（从 `参考.html` 遗留）

这导致了代码不一致，且字体图标需要额外加载字体文件，增加了项目体积。

### 原因分析
在参考 `参考.html` 实现时，直接复制了使用 Phosphor Icons 字体图标的代码，没有统一替换为项目标准的 `@vicons/material` Vue 组件。

### 正确做法

**❌ 错误示例（字体图标）：**
```vue
<template>
  <i class="ph ph-files text-4xl mb-2 opacity-50"></i>
</template>
```

**✅ 正确示例（Vue 组件图标）：**
```vue
<script setup lang="ts">
import { DescriptionOutlined } from '@vicons/material'
</script>

<template>
  <DescriptionOutlined class="size-10 mb-2 opacity-50" />
</template>
```

### 两种图标库的区别

| 特性 | Phosphor Icons (字体) | @vicons/material (Vue 组件) |
|------|---------------------|---------------------------|
| 使用方式 | `<i class="ph-*">` | `<IconName />` |
| 类型安全 | ❌ 无类型检查 | ✅ TypeScript 支持 |
| 按需加载 | ❌ 需要加载整个字体文件 | ✅ 只打包使用的图标 |
| 大小控制 | 使用 `text-*` 类（不推荐） | 使用 `size-*` 或 `w-* h-*` |
| 颜色控制 | 使用 `text-*` 类 | 使用 `text-*` 类 |
| Tree-shaking | ❌ 不支持 | ✅ 支持 |

### 检查方法

使用以下命令检查是否还有遗留的字体图标：

```powershell
# 检查 Phosphor Icons
Get-ChildItem -Path src -Recurse -Filter "*.vue" | ForEach-Object { 
  $content = Get-Content $_.FullName -Raw
  if ($content -match 'class="ph-|class="ph ') { 
    Write-Output $_.FullName 
  } 
}

# 检查其他字体图标库（如 Font Awesome）
Get-ChildItem -Path src -Recurse -Filter "*.vue" | ForEach-Object { 
  $content = Get-Content $_.FullName -Raw
  if ($content -match '<i class="fa-|<i class="fas ') { 
    Write-Output $_.FullName 
  } 
}
```

### 受影响的文件
- `src/modules/search/components/DocFilterModal.vue` - 已修复

### 教训总结

1. **统一技术栈**：项目应该只使用一种图标库，避免混用
2. **参考代码要改造**：从外部参考代码时，要根据项目规范进行改造，不能直接复制
3. **建立检查清单**：在代码审查时检查是否使用了项目标准的图标库
4. **文档化规范**：在项目文档中明确说明使用哪个图标库，以及如何正确使用

### 项目图标使用规范

**本项目统一使用 `@vicons/material` 图标库**

1. **导入图标**：
   ```typescript
   import { IconName } from '@vicons/material'
   ```

2. **使用图标**：
   ```vue
   <IconName class="size-5 text-indigo-600" />
   ```

3. **常用图标大小**：
   - 小图标：`size-4` (16px)
   - 常规图标：`size-5` (20px)
   - 中等图标：`size-6` (24px)
   - 大图标：`size-8` (32px)

4. **禁止使用**：
   - ❌ Phosphor Icons: `<i class="ph-*">`
   - ❌ Font Awesome: `<i class="fa-*">`
   - ❌ 其他字体图标库

### 参考链接
- [@vicons/material 文档](https://www.xicons.org/#/zh-CN)
- [Material Design Icons](https://fonts.google.com/icons)

---
