# 开发问题记录

本文档记录开发过程中遇到的问题和解决方案，避免重复犯错。

---

## 问题 1: Tailwind CSS v4 中 Vue 组件使用 @apply 报错

### 日期
2026-01-14

### 问题描述
在 Vue 组件的 `<style scoped>` 中使用 Tailwind CSS 的 `@apply` 指令时，编译报错：
```
Cannot apply unknown utility class `w-4`. Are you using CSS modules or similar and missing `@reference`?
```

### 原因分析
Tailwind CSS v4 中，如果在 Vue/Svelte 组件的 `<style>` 模块中使用 `@apply` 或 `@variant`，需要先通过 `@reference` 指令导入主题变量、自定义工具和自定义变体。

### 解决方案
在每个使用 `@apply` 的 Vue 组件 `<style>` 标签开头添加 `@reference` 指令：

```vue
<style scoped>
@reference "@/style.css";

.my-class {
  @apply flex items-center;
}
</style>
```

### 教训总结

1. **检查要彻底**：第一次修复时只用 `grep` 搜索找到了 4 个文件，但实际上有 10 个文件需要修复。应该使用更可靠的方法进行全面检查。

2. **正确的检查方法**：使用 PowerShell 脚本同时检查包含 `@apply` 但不包含 `@reference` 的文件：
   ```powershell
   Get-ChildItem -Path src -Recurse -Filter "*.vue" | ForEach-Object { 
     $content = Get-Content $_.FullName -Raw
     if ($content -match "@apply" -and $content -notmatch "@reference") { 
       Write-Output $_.FullName 
     } 
   }
   ```

3. **修复后要验证**：每次修复后都要重新运行检查脚本，确保没有遗漏。

### 受影响的文件清单
- `src/components/modal/SettingsModal.vue`
- `src/components/modal/DetailModal.vue`
- `src/modules/library/pages/LibraryView.vue`
- `src/modules/library/components/FileCard.vue`
- `src/modules/library/components/FileList.vue`
- `src/modules/library/components/FileUploader.vue`
- `src/modules/search/pages/SearchView.vue`
- `src/modules/search/components/SearchBar.vue`
- `src/modules/search/components/SearchResults.vue`
- `src/modules/search/components/ResultCard.vue`
- `src/modules/search/components/SnippetDropdown.vue`
- `src/modules/search/components/DocFilterModal.vue`

### 参考链接
- [Tailwind CSS @reference 指令文档](https://tailwindcss.com/docs/functions-and-directives#reference-directive)

---
